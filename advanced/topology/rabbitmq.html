<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RabbitMQ | MassTransit</title>
    <meta name="description" content="A free, open-source distributed application framework for .NET.">
    
    
    <link rel="preload" href="/MassTransit/assets/css/0.styles.e9548384.css" as="style"><link rel="preload" href="/MassTransit/assets/js/app.763fcc25.js" as="script"><link rel="preload" href="/MassTransit/assets/js/6.b9c46cbe.js" as="script"><link rel="preload" href="/MassTransit/assets/js/1.f2cfa088.js" as="script"><link rel="preload" href="/MassTransit/assets/js/53.2372d01e.js" as="script"><link rel="prefetch" href="/MassTransit/assets/js/10.8a53d3c6.js"><link rel="prefetch" href="/MassTransit/assets/js/100.dea5063d.js"><link rel="prefetch" href="/MassTransit/assets/js/101.fdf33797.js"><link rel="prefetch" href="/MassTransit/assets/js/102.08802a09.js"><link rel="prefetch" href="/MassTransit/assets/js/103.94dfe6b2.js"><link rel="prefetch" href="/MassTransit/assets/js/104.a2200f50.js"><link rel="prefetch" href="/MassTransit/assets/js/105.f38fb744.js"><link rel="prefetch" href="/MassTransit/assets/js/106.5f0d3183.js"><link rel="prefetch" href="/MassTransit/assets/js/107.b3f0d8cf.js"><link rel="prefetch" href="/MassTransit/assets/js/108.59b314d5.js"><link rel="prefetch" href="/MassTransit/assets/js/109.876d62e4.js"><link rel="prefetch" href="/MassTransit/assets/js/11.489768a6.js"><link rel="prefetch" href="/MassTransit/assets/js/110.525aec89.js"><link rel="prefetch" href="/MassTransit/assets/js/111.5d7c6cef.js"><link rel="prefetch" href="/MassTransit/assets/js/12.ca878fb6.js"><link rel="prefetch" href="/MassTransit/assets/js/13.de967d55.js"><link rel="prefetch" href="/MassTransit/assets/js/14.80f79d01.js"><link rel="prefetch" href="/MassTransit/assets/js/15.f0ec9a0d.js"><link rel="prefetch" href="/MassTransit/assets/js/16.07e33012.js"><link rel="prefetch" href="/MassTransit/assets/js/17.a5458ce9.js"><link rel="prefetch" href="/MassTransit/assets/js/18.d0709395.js"><link rel="prefetch" href="/MassTransit/assets/js/19.d6ea4de4.js"><link rel="prefetch" href="/MassTransit/assets/js/20.6f83da94.js"><link rel="prefetch" href="/MassTransit/assets/js/21.394a4a17.js"><link rel="prefetch" href="/MassTransit/assets/js/22.d356c42c.js"><link rel="prefetch" href="/MassTransit/assets/js/23.803d54aa.js"><link rel="prefetch" href="/MassTransit/assets/js/24.9621b1de.js"><link rel="prefetch" href="/MassTransit/assets/js/25.673aa562.js"><link rel="prefetch" href="/MassTransit/assets/js/26.08518995.js"><link rel="prefetch" href="/MassTransit/assets/js/27.8c9631cd.js"><link rel="prefetch" href="/MassTransit/assets/js/28.2bcebacf.js"><link rel="prefetch" href="/MassTransit/assets/js/29.d80bacb6.js"><link rel="prefetch" href="/MassTransit/assets/js/30.cdc44409.js"><link rel="prefetch" href="/MassTransit/assets/js/31.f476159a.js"><link rel="prefetch" href="/MassTransit/assets/js/32.31b6eefe.js"><link rel="prefetch" href="/MassTransit/assets/js/33.79798b43.js"><link rel="prefetch" href="/MassTransit/assets/js/34.cc04befa.js"><link rel="prefetch" href="/MassTransit/assets/js/35.f29df75f.js"><link rel="prefetch" href="/MassTransit/assets/js/36.e9d6cc6d.js"><link rel="prefetch" href="/MassTransit/assets/js/37.dd12c8f5.js"><link rel="prefetch" href="/MassTransit/assets/js/38.31ac2f25.js"><link rel="prefetch" href="/MassTransit/assets/js/39.44e23d20.js"><link rel="prefetch" href="/MassTransit/assets/js/4.6ac43b74.js"><link rel="prefetch" href="/MassTransit/assets/js/40.a5e5045c.js"><link rel="prefetch" href="/MassTransit/assets/js/41.33aebd66.js"><link rel="prefetch" href="/MassTransit/assets/js/42.b885c43e.js"><link rel="prefetch" href="/MassTransit/assets/js/43.ebbd1e2a.js"><link rel="prefetch" href="/MassTransit/assets/js/44.f87ec852.js"><link rel="prefetch" href="/MassTransit/assets/js/45.53e426f0.js"><link rel="prefetch" href="/MassTransit/assets/js/46.21f60550.js"><link rel="prefetch" href="/MassTransit/assets/js/47.85684ee0.js"><link rel="prefetch" href="/MassTransit/assets/js/48.904c9b27.js"><link rel="prefetch" href="/MassTransit/assets/js/49.2ef354b5.js"><link rel="prefetch" href="/MassTransit/assets/js/5.413cd6be.js"><link rel="prefetch" href="/MassTransit/assets/js/50.54704214.js"><link rel="prefetch" href="/MassTransit/assets/js/51.4cc1c6f9.js"><link rel="prefetch" href="/MassTransit/assets/js/52.a945a897.js"><link rel="prefetch" href="/MassTransit/assets/js/54.d69d0b89.js"><link rel="prefetch" href="/MassTransit/assets/js/55.ee9680f6.js"><link rel="prefetch" href="/MassTransit/assets/js/56.ffd754c3.js"><link rel="prefetch" href="/MassTransit/assets/js/57.116a2a32.js"><link rel="prefetch" href="/MassTransit/assets/js/58.d3335fc9.js"><link rel="prefetch" href="/MassTransit/assets/js/59.d0a1c513.js"><link rel="prefetch" href="/MassTransit/assets/js/60.ac18fdea.js"><link rel="prefetch" href="/MassTransit/assets/js/61.4e20793d.js"><link rel="prefetch" href="/MassTransit/assets/js/62.bcf0b140.js"><link rel="prefetch" href="/MassTransit/assets/js/63.52ae8ff6.js"><link rel="prefetch" href="/MassTransit/assets/js/64.819c10c7.js"><link rel="prefetch" href="/MassTransit/assets/js/65.3682be0f.js"><link rel="prefetch" href="/MassTransit/assets/js/66.5e442452.js"><link rel="prefetch" href="/MassTransit/assets/js/67.f0901a9e.js"><link rel="prefetch" href="/MassTransit/assets/js/68.edf45a54.js"><link rel="prefetch" href="/MassTransit/assets/js/69.0691d2ff.js"><link rel="prefetch" href="/MassTransit/assets/js/7.8a51af61.js"><link rel="prefetch" href="/MassTransit/assets/js/70.8e280419.js"><link rel="prefetch" href="/MassTransit/assets/js/71.d655551b.js"><link rel="prefetch" href="/MassTransit/assets/js/72.9f171999.js"><link rel="prefetch" href="/MassTransit/assets/js/73.38a47796.js"><link rel="prefetch" href="/MassTransit/assets/js/74.1753e133.js"><link rel="prefetch" href="/MassTransit/assets/js/75.28f9b3e6.js"><link rel="prefetch" href="/MassTransit/assets/js/76.6dbd3b9e.js"><link rel="prefetch" href="/MassTransit/assets/js/77.7e7a6a46.js"><link rel="prefetch" href="/MassTransit/assets/js/78.f603b82b.js"><link rel="prefetch" href="/MassTransit/assets/js/79.5cee3c98.js"><link rel="prefetch" href="/MassTransit/assets/js/8.6b741284.js"><link rel="prefetch" href="/MassTransit/assets/js/80.6aefc97d.js"><link rel="prefetch" href="/MassTransit/assets/js/81.dcaa7545.js"><link rel="prefetch" href="/MassTransit/assets/js/82.4f71f3b3.js"><link rel="prefetch" href="/MassTransit/assets/js/83.602dc14d.js"><link rel="prefetch" href="/MassTransit/assets/js/84.b2e3702c.js"><link rel="prefetch" href="/MassTransit/assets/js/85.55a4f6af.js"><link rel="prefetch" href="/MassTransit/assets/js/86.f75a06f2.js"><link rel="prefetch" href="/MassTransit/assets/js/87.efc02065.js"><link rel="prefetch" href="/MassTransit/assets/js/88.60fb1dd8.js"><link rel="prefetch" href="/MassTransit/assets/js/89.5dc2cfdb.js"><link rel="prefetch" href="/MassTransit/assets/js/9.9f129a0e.js"><link rel="prefetch" href="/MassTransit/assets/js/90.c3da6b52.js"><link rel="prefetch" href="/MassTransit/assets/js/91.4f25ae4d.js"><link rel="prefetch" href="/MassTransit/assets/js/92.ff3a8464.js"><link rel="prefetch" href="/MassTransit/assets/js/93.26d099c6.js"><link rel="prefetch" href="/MassTransit/assets/js/94.395a5fdd.js"><link rel="prefetch" href="/MassTransit/assets/js/95.885d64a6.js"><link rel="prefetch" href="/MassTransit/assets/js/96.438fc819.js"><link rel="prefetch" href="/MassTransit/assets/js/97.3fe82e70.js"><link rel="prefetch" href="/MassTransit/assets/js/98.6add9580.js"><link rel="prefetch" href="/MassTransit/assets/js/99.d7afcafc.js"><link rel="prefetch" href="/MassTransit/assets/js/vuejs-paginate.55199f2c.js">
    <link rel="stylesheet" href="/MassTransit/assets/css/0.styles.e9548384.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/MassTransit/" class="home-link router-link-active"><img src="/MassTransit/mt-logo-small.png" alt="MassTransit" class="logo"> <span class="site-name can-hide">MassTransit</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/MassTransit/updates/" class="nav-link">Blog</a></div><div class="nav-item"><a href="https://gitter.im/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/MassTransit/updates/" class="nav-link">Blog</a></div><div class="nav-item"><a href="https://gitter.im/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/MassTransit/getting-started/" class="sidebar-heading clickable"><span>Getting Started</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/MassTransit/getting-started/upgrade-v6.html" class="sidebar-link">Upgrading</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/MassTransit/usage/" class="sidebar-heading clickable open"><span>Using MassTransit</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/MassTransit/usage/configuration.html" class="sidebar-link">Configuration</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/MassTransit/usage/transports/" class="sidebar-heading clickable"><span>Transports</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/MassTransit/usage/messages.html" class="sidebar-link">Messages</a></li><li><a href="/MassTransit/usage/consumers.html" class="sidebar-link">Consumers</a></li><li><a href="/MassTransit/usage/producers.html" class="sidebar-link">Producers</a></li><li><a href="/MassTransit/usage/exceptions.html" class="sidebar-link">Exceptions</a></li><li><a href="/MassTransit/usage/requests.html" class="sidebar-link">Requests</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/MassTransit/usage/sagas/" class="sidebar-heading clickable"><span>Sagas</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/MassTransit/usage/containers/" class="sidebar-heading clickable"><span>Containers</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/MassTransit/usage/testing.html" class="sidebar-link">Testing</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Advanced</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/MassTransit/advanced/scheduling/" class="sidebar-heading clickable"><span>Scheduling</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/MassTransit/advanced/courier/" class="sidebar-heading clickable"><span>Courier</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/MassTransit/advanced/middleware/" class="sidebar-heading clickable"><span>Middleware</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/MassTransit/usage/message-data.html" class="sidebar-link">Message Data</a></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>Monitoring</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/MassTransit/advanced/connect-endpoint.html" class="sidebar-link">Connect Endpoint</a></li><li><a href="/MassTransit/advanced/observers.html" class="sidebar-link">Observers</a></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/MassTransit/advanced/topology/" class="sidebar-heading clickable router-link-active open"><span>Topology</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/MassTransit/advanced/topology/message.html" class="sidebar-link">Message Topology</a></li><li><a href="/MassTransit/advanced/topology/publish.html" class="sidebar-link">Publish Topology</a></li><li><a href="/MassTransit/advanced/topology/send.html" class="sidebar-link">Send Topology</a></li><li><a href="/MassTransit/advanced/topology/consume.html" class="sidebar-link">Consume Topology</a></li><li><a href="/MassTransit/advanced/topology/conventions.html" class="sidebar-link">Topology Conventions</a></li><li><a href="/MassTransit/advanced/topology/rabbitmq.html" class="active sidebar-link">RabbitMQ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/MassTransit/advanced/topology/rabbitmq.html#exchange-properties" class="sidebar-link">Exchange Properties</a></li><li class="sidebar-sub-header"><a href="/MassTransit/advanced/topology/rabbitmq.html#hierarchical-exchange-layout" class="sidebar-link">Hierarchical Exchange Layout</a></li><li class="sidebar-sub-header"><a href="/MassTransit/advanced/topology/rabbitmq.html#exchange-binding" class="sidebar-link">Exchange Binding</a></li><li class="sidebar-sub-header"><a href="/MassTransit/advanced/topology/rabbitmq.html#routing-key" class="sidebar-link">Routing Key</a></li><li class="sidebar-sub-header"><a href="/MassTransit/advanced/topology/rabbitmq.html#addresses" class="sidebar-link">Addresses</a></li><li class="sidebar-sub-header"><a href="/MassTransit/advanced/topology/rabbitmq.html#default-topology" class="sidebar-link">Default Topology</a></li></ul></li><li><a href="/MassTransit/advanced/topology/servicebus.html" class="sidebar-link">Azure Service Bus</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/MassTransit/advanced/signalr/" class="sidebar-heading clickable"><span>SignalR</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/MassTransit/advanced/audit.html" class="sidebar-link">Message Audit</a></li><li><a href="/MassTransit/advanced/batching.html" class="sidebar-link">Batching</a></li><li><a href="/MassTransit/advanced/turnout/" class="sidebar-link">Turnout</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/MassTransit/learn/" class="sidebar-heading clickable"><span>Getting Help</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Reference</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="rabbitmq"><a href="#rabbitmq" class="header-anchor">#</a> RabbitMQ</h1> <p>The send and publish topologies are extended to support RabbitMQ features, and make it possible to configure how exchanged are created.</p> <h2 id="exchange-properties"><a href="#exchange-properties" class="header-anchor">#</a> Exchange Properties</h2> <p>When a message is published, MassTransit sends it to an exchange that is named based upon the message type. Using topology, the exchange name, as well as the exchange properties can be configured to support a custom behavior.</p> <p>To configure the properties used when an exchange is created, the publish topology can be configured during bus creation:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Bus<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">CreateUsingRabbitMQ</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> cfg <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    cfg<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Publish</span><span class="token punctuation">&lt;</span><span class="token class-name">OrderSubmitted</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        x<span class="token punctuation">.</span>Durable <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span> <span class="token comment">// default: true</span>
        x<span class="token punctuation">.</span>AutoDelete <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span> <span class="token comment">// default: false</span>
        x<span class="token punctuation">.</span>ExchangeType <span class="token operator">=</span> <span class="token string">&quot;fanout&quot;</span><span class="token punctuation">;</span> <span class="token comment">// default</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="hierarchical-exchange-layout"><a href="#hierarchical-exchange-layout" class="header-anchor">#</a> Hierarchical Exchange Layout</h2> <p>In versions of MassTransit prior to 4.x, every implemented type was connected directly to the top-level exchange for the published message type. Starting with v4.0, the broker topology for inherited types can be configured to maintain the type hierarchy, which can significantly reduce the number of exchange bindings in some cases. To configure this new behavior, the publish topology is used to specify the broker topology option.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Bus<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">CreateUsingRabbitMQ</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> cfg <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    cfg<span class="token punctuation">.</span>PublishTopology<span class="token punctuation">.</span>BrokerTopologyOptions <span class="token operator">=</span> PublishBrokerTopologyOptions<span class="token punctuation">.</span>MaintainHierarchy<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="exchange-binding"><a href="#exchange-binding" class="header-anchor">#</a> Exchange Binding</h2> <p>To bind an exchange to a receive endpoint:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>cfg<span class="token punctuation">.</span><span class="token function">ReceiveEndpoint</span><span class="token punctuation">(</span><span class="token string">&quot;input-queue&quot;</span><span class="token punctuation">,</span> e <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span><span class="token string">&quot;exchange-name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Bind</span><span class="token punctuation">&lt;</span><span class="token class-name">MessageType</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>The above will create two exchange bindings, one between the <code>exchange-name</code> exchange and the <code>input-queue</code> exchange and a second between the exchange name matching the <code>MessageType</code> and the same <code>input-queue</code> exchange.</p> <p>The properties of the exchange binding may also be configured:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>cfg<span class="token punctuation">.</span><span class="token function">ReceiveEndpoint</span><span class="token punctuation">(</span><span class="token string">&quot;input-queue&quot;</span><span class="token punctuation">,</span> e <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span><span class="token string">&quot;exchange-name&quot;</span><span class="token punctuation">,</span> x <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        x<span class="token punctuation">.</span>Durable <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>
        x<span class="token punctuation">.</span>AutoDelete <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>
        x<span class="token punctuation">.</span>ExchangeType <span class="token operator">=</span> <span class="token string">&quot;direct&quot;</span><span class="token punctuation">;</span>
        x<span class="token punctuation">.</span>RoutingKey <span class="token operator">=</span> <span class="token string">&quot;8675309&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>The above will create an exchange binding between the <code>exchange-name</code> and the <code>input-queue</code> exchange, using the configured properties.</p> <h2 id="routing-key"><a href="#routing-key" class="header-anchor">#</a> Routing Key</h2> <p>The routing key on published/sent messages can be configured by convention, allowing the same method to be used for messages which implement a common interface type. If no common type is shared, each message type may be configured individually using various conventional selectors. Alternatively, developers may create their own convention to fit their needs.</p> <p>When configuring a bus, the send topology can be used to specify a routing key formatter for a particular message type.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SubmitOrder</span>
<span class="token punctuation">{</span>
    <span class="token keyword">string</span> CustomerType <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token class-name">Guid</span> TransactionId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

Bus<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">CreateUsingRabbitMQ</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> cfg <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    cfg<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Send</span><span class="token punctuation">&lt;</span><span class="token class-name">SubmitOrder</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// use customerType for the routing key</span>
        x<span class="token punctuation">.</span><span class="token function">UseRoutingKeyFormatter</span><span class="token punctuation">(</span>context <span class="token operator">=&gt;</span> context<span class="token punctuation">.</span>Message<span class="token punctuation">.</span>CustomerType<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// multiple conventions can be set, in this case also CorrelationId</span>
        x<span class="token punctuation">.</span><span class="token function">UseCorrelationId</span><span class="token punctuation">(</span>context <span class="token operator">=&gt;</span> context<span class="token punctuation">.</span>Message<span class="token punctuation">.</span>TransactionId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//Keeping in mind that the default exchange config for your published type will be the full typename of your message</span>
    <span class="token comment">//we explicitly specify which exchange the message will be published to. So it lines up with the exchange we are binding our</span>
    <span class="token comment">//consumers too.</span>
    cfg<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Message</span><span class="token punctuation">&lt;</span><span class="token class-name">SubmitOrder</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">SetEntityName</span><span class="token punctuation">(</span><span class="token string">&quot;submitorder&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//Also if your publishing your message: because publishing a message will, by default, send it to a fanout queue. </span>
    <span class="token comment">//We specify that we are sending it to a direct queue instead. In order for the routingkeys to take effect.</span>
    cfg<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Publish</span><span class="token punctuation">&lt;</span><span class="token class-name">SubmitOrder</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>ExchangeType <span class="token operator">=</span> ExchangeType<span class="token punctuation">.</span>Direct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The consumer could then be created:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderConsumer</span> <span class="token punctuation">:</span>
    <span class="token class-name">IConsumer</span><span class="token operator">&lt;</span>SubmitOrder<span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token class-name">Task</span> <span class="token function">Consume</span><span class="token punctuation">(</span>ConsumeContext<span class="token operator">&lt;</span>SubmitOrder<span class="token operator">&gt;</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>And then connected to a receive endpoint:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>Bus<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">CreateUsingRabbitMQ</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> cfg <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    cfg<span class="token punctuation">.</span><span class="token function">ReceiveEndpoint</span><span class="token punctuation">(</span><span class="token string">&quot;priority-orders&quot;</span><span class="token punctuation">,</span> x <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        x<span class="token punctuation">.</span>BindMessageExchanges <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>

        x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Consumer</span><span class="token punctuation">&lt;</span><span class="token class-name">OrderConsumer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        x<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span><span class="token string">&quot;submitorder&quot;</span><span class="token punctuation">,</span> s <span class="token operator">=&gt;</span> 
        <span class="token punctuation">{</span>
            s<span class="token punctuation">.</span>RoutingKey <span class="token operator">=</span> <span class="token string">&quot;PRIORITY&quot;</span><span class="token punctuation">;</span>
            s<span class="token punctuation">.</span>ExchangeType <span class="token operator">=</span> ExchangeType<span class="token punctuation">.</span>Direct<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    cfg<span class="token punctuation">.</span><span class="token function">ReceiveEndpoint</span><span class="token punctuation">(</span><span class="token string">&quot;regular-orders&quot;</span><span class="token punctuation">,</span> x <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        x<span class="token punctuation">.</span>BindMessageExchanges <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>

        x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Consumer</span><span class="token punctuation">&lt;</span><span class="token class-name">OrderConsumer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        x<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span><span class="token string">&quot;submitorder&quot;</span><span class="token punctuation">,</span> s <span class="token operator">=&gt;</span> 
        <span class="token punctuation">{</span>
            s<span class="token punctuation">.</span>RoutingKey <span class="token operator">=</span> <span class="token string">&quot;REGULAR&quot;</span><span class="token punctuation">;</span>
            s<span class="token punctuation">.</span>ExchangeType <span class="token operator">=</span> ExchangeType<span class="token punctuation">.</span>Direct<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This would split the messages sent to the exchange, by routing key, to the proper endpoint, using the CustomerType property.</p> <h2 id="addresses"><a href="#addresses" class="header-anchor">#</a> Addresses</h2> <p>Query string parameters supported:</p> <h3 id="rabbitmq-query-parameters"><a href="#rabbitmq-query-parameters" class="header-anchor">#</a> RabbitMQ Query Parameters</h3> <table><thead><tr><th>Parameter</th> <th>Type</th> <th>Description</th> <th>Implies</th></tr></thead> <tbody><tr><td>temporary</td> <td>bool</td> <td>Temporary endpoint</td> <td>durable = false, autodelete = true</td></tr> <tr><td>durable</td> <td>bool</td> <td>Save messages to disk</td> <td></td></tr> <tr><td>autodelete</td> <td>bool</td> <td>Delete when bus is stopped</td> <td></td></tr> <tr><td>bind</td> <td>bool</td> <td>Bind exchange to queue</td> <td></td></tr> <tr><td>queue</td> <td>string</td> <td>Bind to queue name</td> <td>bind = true</td></tr></tbody></table> <h2 id="default-topology"><a href="#default-topology" class="header-anchor">#</a> Default Topology</h2> <p>In this example topology, two commands and events are used.</p> <p>First, the event contracts that are supported by an endpoint that receives files from a customer.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">interface</span> <span class="token class-name">FileReceived</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Guid</span> FileId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token class-name">DateTime</span> Timestamp <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token class-name">Uri</span> Location <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">CustomerDataReceived</span>
<span class="token punctuation">{</span>
    <span class="token class-name">DateTime</span> Timestamp <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">string</span> CustomerId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">string</span> SourceAddress <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token class-name">Uri</span> Location <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Second, the command contract for processing a file that was received.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">interface</span> <span class="token class-name">ProcessFile</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Guid</span> FileId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token class-name">Uri</span> Location <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The above contracts are used by the consumers to receive messages. From a publishing or sending perspective, two classes are created by the event producer and the command sender which implement these interfaces.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">FileReceivedEvent</span> <span class="token punctuation">:</span>
    <span class="token class-name">FileReceived</span><span class="token punctuation">,</span>
    CustomerDataReceived
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Guid</span> FileId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">DateTime</span> Timestamp <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">Uri</span> Location <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> CustomerId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> SourceAddress <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>And the command class.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">ProcessFileCommand</span> <span class="token punctuation">:</span>
    <span class="token class-name">ProcessFile</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Guid</span> FileId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>   
    <span class="token keyword">public</span> <span class="token class-name">Uri</span> Location <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The consumers for these message contracts are as below.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">class</span> <span class="token class-name">FileReceivedConsumer</span> <span class="token punctuation">:</span>
    <span class="token class-name">IConsumer</span><span class="token operator">&lt;</span>FileReceived<span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">CustomerAuditConsumer</span> <span class="token punctuation">:</span>
    <span class="token class-name">IConsumer</span><span class="token operator">&lt;</span>CustomerDataReceived<span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ProcessFileConsumer</span> <span class="token punctuation">:</span>
    <span class="token class-name">IConsumer</span><span class="token operator">&lt;</span>ProcessFile<span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="publish"><a href="#publish" class="header-anchor">#</a> Publish</h3> <p>The exchanges and queues configures for the event example are as shown below.</p> <blockquote><p>MassTransit publishes messages to the message type exchange, and copies are routed to all the subscribers by RabbitMQ. This approach was <a href="http://spring.io/blog/2011/04/01/routing-topologies-for-performance-and-scalability-with-rabbitmq/" target="_blank" rel="noopener noreferrer">based on an article<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> on how to maximize routing performance in RabbitMQ.</p></blockquote> <p><img src="/rabbitmq-publish-topology.png" alt="rabbitmq-publish-topology"></p> <h3 id="send"><a href="#send" class="header-anchor">#</a> Send</h3> <p>The exchanges and queues for the send example are shown.</p> <p><img src="/rabbitmq-send-topology.png" alt="rabbitmq-send-topology"></p> <blockquote><p>Note that the broker topology can now be configured using the <a href="/MassTransit/advanced/advanced/topology/">topology</a> API.</p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/MassTransit/MassTransit/edit/develop/docs/advanced/topology/rabbitmq.md" target="_blank" rel="noopener noreferrer">Help us by improving this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/11/2019, 3:58:22 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/MassTransit/advanced/topology/conventions.html" class="prev">Topology Conventions</a></span> <span class="next"><a href="/MassTransit/advanced/topology/servicebus.html">Azure Service Bus</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/MassTransit/assets/js/app.763fcc25.js" defer></script><script src="/MassTransit/assets/js/6.b9c46cbe.js" defer></script><script src="/MassTransit/assets/js/1.f2cfa088.js" defer></script><script src="/MassTransit/assets/js/53.2372d01e.js" defer></script>
  </body>
</html>
