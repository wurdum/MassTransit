<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Observers | MassTransit</title>
    <meta name="description" content="A free, open-source distributed application framework for .NET.">
    
    
    <link rel="preload" href="/MassTransit/assets/css/0.styles.e9548384.css" as="style"><link rel="preload" href="/MassTransit/assets/js/app.763fcc25.js" as="script"><link rel="preload" href="/MassTransit/assets/js/6.b9c46cbe.js" as="script"><link rel="preload" href="/MassTransit/assets/js/1.f2cfa088.js" as="script"><link rel="preload" href="/MassTransit/assets/js/34.cc04befa.js" as="script"><link rel="prefetch" href="/MassTransit/assets/js/10.8a53d3c6.js"><link rel="prefetch" href="/MassTransit/assets/js/100.dea5063d.js"><link rel="prefetch" href="/MassTransit/assets/js/101.fdf33797.js"><link rel="prefetch" href="/MassTransit/assets/js/102.08802a09.js"><link rel="prefetch" href="/MassTransit/assets/js/103.94dfe6b2.js"><link rel="prefetch" href="/MassTransit/assets/js/104.a2200f50.js"><link rel="prefetch" href="/MassTransit/assets/js/105.f38fb744.js"><link rel="prefetch" href="/MassTransit/assets/js/106.5f0d3183.js"><link rel="prefetch" href="/MassTransit/assets/js/107.b3f0d8cf.js"><link rel="prefetch" href="/MassTransit/assets/js/108.59b314d5.js"><link rel="prefetch" href="/MassTransit/assets/js/109.876d62e4.js"><link rel="prefetch" href="/MassTransit/assets/js/11.489768a6.js"><link rel="prefetch" href="/MassTransit/assets/js/110.525aec89.js"><link rel="prefetch" href="/MassTransit/assets/js/111.5d7c6cef.js"><link rel="prefetch" href="/MassTransit/assets/js/12.ca878fb6.js"><link rel="prefetch" href="/MassTransit/assets/js/13.de967d55.js"><link rel="prefetch" href="/MassTransit/assets/js/14.80f79d01.js"><link rel="prefetch" href="/MassTransit/assets/js/15.f0ec9a0d.js"><link rel="prefetch" href="/MassTransit/assets/js/16.07e33012.js"><link rel="prefetch" href="/MassTransit/assets/js/17.a5458ce9.js"><link rel="prefetch" href="/MassTransit/assets/js/18.d0709395.js"><link rel="prefetch" href="/MassTransit/assets/js/19.d6ea4de4.js"><link rel="prefetch" href="/MassTransit/assets/js/20.6f83da94.js"><link rel="prefetch" href="/MassTransit/assets/js/21.394a4a17.js"><link rel="prefetch" href="/MassTransit/assets/js/22.d356c42c.js"><link rel="prefetch" href="/MassTransit/assets/js/23.803d54aa.js"><link rel="prefetch" href="/MassTransit/assets/js/24.9621b1de.js"><link rel="prefetch" href="/MassTransit/assets/js/25.673aa562.js"><link rel="prefetch" href="/MassTransit/assets/js/26.08518995.js"><link rel="prefetch" href="/MassTransit/assets/js/27.8c9631cd.js"><link rel="prefetch" href="/MassTransit/assets/js/28.2bcebacf.js"><link rel="prefetch" href="/MassTransit/assets/js/29.d80bacb6.js"><link rel="prefetch" href="/MassTransit/assets/js/30.cdc44409.js"><link rel="prefetch" href="/MassTransit/assets/js/31.f476159a.js"><link rel="prefetch" href="/MassTransit/assets/js/32.31b6eefe.js"><link rel="prefetch" href="/MassTransit/assets/js/33.79798b43.js"><link rel="prefetch" href="/MassTransit/assets/js/35.f29df75f.js"><link rel="prefetch" href="/MassTransit/assets/js/36.e9d6cc6d.js"><link rel="prefetch" href="/MassTransit/assets/js/37.dd12c8f5.js"><link rel="prefetch" href="/MassTransit/assets/js/38.31ac2f25.js"><link rel="prefetch" href="/MassTransit/assets/js/39.44e23d20.js"><link rel="prefetch" href="/MassTransit/assets/js/4.6ac43b74.js"><link rel="prefetch" href="/MassTransit/assets/js/40.a5e5045c.js"><link rel="prefetch" href="/MassTransit/assets/js/41.33aebd66.js"><link rel="prefetch" href="/MassTransit/assets/js/42.b885c43e.js"><link rel="prefetch" href="/MassTransit/assets/js/43.ebbd1e2a.js"><link rel="prefetch" href="/MassTransit/assets/js/44.f87ec852.js"><link rel="prefetch" href="/MassTransit/assets/js/45.53e426f0.js"><link rel="prefetch" href="/MassTransit/assets/js/46.21f60550.js"><link rel="prefetch" href="/MassTransit/assets/js/47.85684ee0.js"><link rel="prefetch" href="/MassTransit/assets/js/48.904c9b27.js"><link rel="prefetch" href="/MassTransit/assets/js/49.2ef354b5.js"><link rel="prefetch" href="/MassTransit/assets/js/5.413cd6be.js"><link rel="prefetch" href="/MassTransit/assets/js/50.54704214.js"><link rel="prefetch" href="/MassTransit/assets/js/51.4cc1c6f9.js"><link rel="prefetch" href="/MassTransit/assets/js/52.a945a897.js"><link rel="prefetch" href="/MassTransit/assets/js/53.2372d01e.js"><link rel="prefetch" href="/MassTransit/assets/js/54.d69d0b89.js"><link rel="prefetch" href="/MassTransit/assets/js/55.ee9680f6.js"><link rel="prefetch" href="/MassTransit/assets/js/56.ffd754c3.js"><link rel="prefetch" href="/MassTransit/assets/js/57.116a2a32.js"><link rel="prefetch" href="/MassTransit/assets/js/58.d3335fc9.js"><link rel="prefetch" href="/MassTransit/assets/js/59.d0a1c513.js"><link rel="prefetch" href="/MassTransit/assets/js/60.ac18fdea.js"><link rel="prefetch" href="/MassTransit/assets/js/61.4e20793d.js"><link rel="prefetch" href="/MassTransit/assets/js/62.bcf0b140.js"><link rel="prefetch" href="/MassTransit/assets/js/63.52ae8ff6.js"><link rel="prefetch" href="/MassTransit/assets/js/64.819c10c7.js"><link rel="prefetch" href="/MassTransit/assets/js/65.3682be0f.js"><link rel="prefetch" href="/MassTransit/assets/js/66.5e442452.js"><link rel="prefetch" href="/MassTransit/assets/js/67.f0901a9e.js"><link rel="prefetch" href="/MassTransit/assets/js/68.edf45a54.js"><link rel="prefetch" href="/MassTransit/assets/js/69.0691d2ff.js"><link rel="prefetch" href="/MassTransit/assets/js/7.8a51af61.js"><link rel="prefetch" href="/MassTransit/assets/js/70.8e280419.js"><link rel="prefetch" href="/MassTransit/assets/js/71.d655551b.js"><link rel="prefetch" href="/MassTransit/assets/js/72.9f171999.js"><link rel="prefetch" href="/MassTransit/assets/js/73.38a47796.js"><link rel="prefetch" href="/MassTransit/assets/js/74.1753e133.js"><link rel="prefetch" href="/MassTransit/assets/js/75.28f9b3e6.js"><link rel="prefetch" href="/MassTransit/assets/js/76.6dbd3b9e.js"><link rel="prefetch" href="/MassTransit/assets/js/77.7e7a6a46.js"><link rel="prefetch" href="/MassTransit/assets/js/78.f603b82b.js"><link rel="prefetch" href="/MassTransit/assets/js/79.5cee3c98.js"><link rel="prefetch" href="/MassTransit/assets/js/8.6b741284.js"><link rel="prefetch" href="/MassTransit/assets/js/80.6aefc97d.js"><link rel="prefetch" href="/MassTransit/assets/js/81.dcaa7545.js"><link rel="prefetch" href="/MassTransit/assets/js/82.4f71f3b3.js"><link rel="prefetch" href="/MassTransit/assets/js/83.602dc14d.js"><link rel="prefetch" href="/MassTransit/assets/js/84.b2e3702c.js"><link rel="prefetch" href="/MassTransit/assets/js/85.55a4f6af.js"><link rel="prefetch" href="/MassTransit/assets/js/86.f75a06f2.js"><link rel="prefetch" href="/MassTransit/assets/js/87.efc02065.js"><link rel="prefetch" href="/MassTransit/assets/js/88.60fb1dd8.js"><link rel="prefetch" href="/MassTransit/assets/js/89.5dc2cfdb.js"><link rel="prefetch" href="/MassTransit/assets/js/9.9f129a0e.js"><link rel="prefetch" href="/MassTransit/assets/js/90.c3da6b52.js"><link rel="prefetch" href="/MassTransit/assets/js/91.4f25ae4d.js"><link rel="prefetch" href="/MassTransit/assets/js/92.ff3a8464.js"><link rel="prefetch" href="/MassTransit/assets/js/93.26d099c6.js"><link rel="prefetch" href="/MassTransit/assets/js/94.395a5fdd.js"><link rel="prefetch" href="/MassTransit/assets/js/95.885d64a6.js"><link rel="prefetch" href="/MassTransit/assets/js/96.438fc819.js"><link rel="prefetch" href="/MassTransit/assets/js/97.3fe82e70.js"><link rel="prefetch" href="/MassTransit/assets/js/98.6add9580.js"><link rel="prefetch" href="/MassTransit/assets/js/99.d7afcafc.js"><link rel="prefetch" href="/MassTransit/assets/js/vuejs-paginate.55199f2c.js">
    <link rel="stylesheet" href="/MassTransit/assets/css/0.styles.e9548384.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/MassTransit/" class="home-link router-link-active"><img src="/MassTransit/mt-logo-small.png" alt="MassTransit" class="logo"> <span class="site-name can-hide">MassTransit</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/MassTransit/updates/" class="nav-link">Blog</a></div><div class="nav-item"><a href="https://gitter.im/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/MassTransit/updates/" class="nav-link">Blog</a></div><div class="nav-item"><a href="https://gitter.im/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/MassTransit/getting-started/" class="sidebar-heading clickable"><span>Getting Started</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/MassTransit/getting-started/upgrade-v6.html" class="sidebar-link">Upgrading</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/MassTransit/usage/" class="sidebar-heading clickable open"><span>Using MassTransit</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/MassTransit/usage/configuration.html" class="sidebar-link">Configuration</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/MassTransit/usage/transports/" class="sidebar-heading clickable"><span>Transports</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/MassTransit/usage/messages.html" class="sidebar-link">Messages</a></li><li><a href="/MassTransit/usage/consumers.html" class="sidebar-link">Consumers</a></li><li><a href="/MassTransit/usage/producers.html" class="sidebar-link">Producers</a></li><li><a href="/MassTransit/usage/exceptions.html" class="sidebar-link">Exceptions</a></li><li><a href="/MassTransit/usage/requests.html" class="sidebar-link">Requests</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/MassTransit/usage/sagas/" class="sidebar-heading clickable"><span>Sagas</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/MassTransit/usage/containers/" class="sidebar-heading clickable"><span>Containers</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/MassTransit/usage/testing.html" class="sidebar-link">Testing</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Advanced</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/MassTransit/advanced/scheduling/" class="sidebar-heading clickable open"><span>Scheduling</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/MassTransit/advanced/scheduling/scheduling-api.html" class="sidebar-link">Message Scheduler</a></li><li><a href="/MassTransit/advanced/scheduling/in-memory.html" class="sidebar-link">In-Memory</a></li><li><a href="/MassTransit/advanced/scheduling/azure-sb-scheduler.html" class="sidebar-link">Azure Service Bus</a></li><li><a href="/MassTransit/advanced/scheduling/rabbitmq-delayed.html" class="sidebar-link">RabbitMQ Scheduler</a></li><li><a href="/MassTransit/advanced/scheduling/redeliver.html" class="sidebar-link">Scheduled Redelivery</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/MassTransit/advanced/courier/" class="sidebar-heading clickable"><span>Courier</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/MassTransit/advanced/middleware/" class="sidebar-heading clickable"><span>Middleware</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/MassTransit/usage/message-data.html" class="sidebar-link">Message Data</a></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>Monitoring</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/MassTransit/advanced/connect-endpoint.html" class="sidebar-link">Connect Endpoint</a></li><li><a href="/MassTransit/advanced/observers.html" class="active sidebar-link">Observers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/MassTransit/advanced/observers.html#received-messages" class="sidebar-link">Received Messages</a></li><li class="sidebar-sub-header"><a href="/MassTransit/advanced/observers.html#consumed-messages" class="sidebar-link">Consumed Messages</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/MassTransit/advanced/observers.html#types-consumed-messages" class="sidebar-link">Types Consumed Messages</a></li></ul></li><li class="sidebar-sub-header"><a href="/MassTransit/advanced/observers.html#sent-messages" class="sidebar-link">Sent Messages</a></li><li class="sidebar-sub-header"><a href="/MassTransit/advanced/observers.html#published-messages" class="sidebar-link">Published Messages</a></li></ul></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/MassTransit/advanced/topology/" class="sidebar-heading clickable"><span>Topology</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/MassTransit/advanced/signalr/" class="sidebar-heading clickable"><span>SignalR</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/MassTransit/advanced/audit.html" class="sidebar-link">Message Audit</a></li><li><a href="/MassTransit/advanced/batching.html" class="sidebar-link">Batching</a></li><li><a href="/MassTransit/advanced/turnout/" class="sidebar-link">Turnout</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/MassTransit/learn/" class="sidebar-heading clickable"><span>Getting Help</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Reference</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="observers"><a href="#observers" class="header-anchor">#</a> Observers</h1> <p>MassTransit supports a number of message observes, making it possible to monitor when messages are received, consumed, sent, and published. Each type of observer is configured separately, keeping the interfaces lean and focused.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Observers should not be used to modify or intercept messages. To intercept messages (to either add headers or modify message content), create a new or use an existing middleware component.</p></div> <h2 id="received-messages"><a href="#received-messages" class="header-anchor">#</a> Received Messages</h2> <p>To observe messages as they are received by the transport, create a class that implements the <code>IReceiveObserver</code> interface, and connect it to the bus as shown below.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReceiveObserver</span> <span class="token punctuation">:</span> 
    <span class="token class-name">IReceiveObserver</span>
<span class="token punctuation">{</span>    
    <span class="token keyword">public</span> <span class="token class-name">Task</span> <span class="token function">PreReceive</span><span class="token punctuation">(</span><span class="token class-name">ReceiveContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// called immediately after the message was delivery by the transport</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Task</span> <span class="token function">PostReceive</span><span class="token punctuation">(</span><span class="token class-name">ReceiveContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// called after the message has been received and processed</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> Task <span class="token generic-method"><span class="token function">PostConsume</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>ConsumeContext<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> context<span class="token punctuation">,</span> <span class="token class-name">TimeSpan</span> duration<span class="token punctuation">,</span> <span class="token keyword">string</span> consumerType<span class="token punctuation">)</span>
        <span class="token keyword">where</span> T <span class="token punctuation">:</span> <span class="token keyword">class</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// called when the message was consumed, once for each consumer</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> Task <span class="token generic-method"><span class="token function">ConsumeFault</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>ConsumeContext<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> context<span class="token punctuation">,</span> <span class="token class-name">TimeSpan</span> elapsed<span class="token punctuation">,</span> <span class="token keyword">string</span> consumerType<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span> <span class="token keyword">where</span> T <span class="token punctuation">:</span> <span class="token keyword">class</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// called when the message is consumed but the consumer throws an exception</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Task</span> <span class="token function">ReceiveFault</span><span class="token punctuation">(</span><span class="token class-name">ReceiveContext</span> context<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// called when an exception occurs early in the message processing, such as deserialization, etc.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then connect the observer to the bus before starting it, as shown.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> busControl <span class="token operator">=</span> Bus<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">CreateUsingRabbitMq</span><span class="token punctuation">(</span>cfg <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    cfg<span class="token punctuation">.</span><span class="token function">Host</span><span class="token punctuation">(</span><span class="token string">&quot;rabbitmq://localhost/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    cfg<span class="token punctuation">.</span><span class="token function">ReceiveEndpoint</span><span class="token punctuation">(</span><span class="token string">&quot;customer_update_queue&quot;</span><span class="token punctuation">,</span> e <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Consumer</span><span class="token punctuation">&lt;</span><span class="token class-name">UpdateCustomerConsumer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReceiveObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> handle <span class="token operator">=</span> busControl<span class="token punctuation">.</span><span class="token function">ConnectReceiveObserver</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">await</span> busControl<span class="token punctuation">.</span><span class="token function">StartAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="consumed-messages"><a href="#consumed-messages" class="header-anchor">#</a> Consumed Messages</h2> <p>If the receive context isn't super interesting, perhaps the actual consumption of messages might float your boat. A consume observer implements the <code>IConsumeObserver</code> interface, as shown below.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumeObserver</span> <span class="token punctuation">:</span> <span class="token class-name">IConsumeObserver</span>
<span class="token punctuation">{</span>    
    <span class="token class-name">Task</span> IConsumeObserver<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">PreConsume</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>ConsumeContext<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// called before the consumer's Consume method is called</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">Task</span> IConsumeObserver<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">PostConsume</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>ConsumeContext<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// called after the consumer's Consume method is called</span>
        <span class="token comment">// if an exception was thrown, the ConsumeFault method is called instead</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">Task</span> IConsumeObserver<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ConsumeFault</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>ConsumeContext<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> context<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// called if the consumer's Consume method throws an exception</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To connect the observer, use the <code>ConnectConsumeObserver</code> method before starting the bus.</p> <h3 id="types-consumed-messages"><a href="#types-consumed-messages" class="header-anchor">#</a> Types Consumed Messages</h3> <p>Okay, so it's obvious that if you've read this far you want a more specific observer, one that only is called when a specific message type is consumed. We have you covered there too, as shown below.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsumeObserver</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">:</span> IConsumeMessageObserver<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token keyword">where</span> T <span class="token punctuation">:</span> <span class="token keyword">class</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Task</span> IConsumeMessageObserver<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">PreConsume</span><span class="token punctuation">(</span>ConsumeContext<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// called before the consumer's Consume method is called</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">Task</span> IConsumeMessageObserver<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">PostConsume</span><span class="token punctuation">(</span>ConsumeContext<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// called after the consumer's Consume method was called</span>
        <span class="token comment">// again, exceptions call the Fault method.</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">Task</span> IConsumeMessageObserver<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">ConsumeFault</span><span class="token punctuation">(</span>ConsumeContext<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> context<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// called when a consumer throws an exception consuming the message</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To connect the observer, use the <code>ConnectConsumeMessageObserver</code> method before starting the bus.</p> <h2 id="sent-messages"><a href="#sent-messages" class="header-anchor">#</a> Sent Messages</h2> <p>Okay, so, incoming messages are not your thing. We get it, you're all about what goes out. It's cool. It's better to send than to receive. Or is that give? Anyway, a send observer is also available.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendObserver</span> <span class="token punctuation">:</span> <span class="token class-name">ISendObserver</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> Task <span class="token generic-method"><span class="token function">PreSend</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>SendContext<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> context<span class="token punctuation">)</span>
        <span class="token keyword">where</span> T <span class="token punctuation">:</span> <span class="token keyword">class</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// called just before a message is sent, all the headers should be setup and everything</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> Task <span class="token generic-method"><span class="token function">PostSend</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>SendContext<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> context<span class="token punctuation">)</span>
        <span class="token keyword">where</span> T <span class="token punctuation">:</span> <span class="token keyword">class</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// called just after a message it sent to the transport and acknowledged (RabbitMQ)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> Task <span class="token generic-method"><span class="token function">SendFault</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>SendContext<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> context<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span>
        <span class="token keyword">where</span> T <span class="token punctuation">:</span> <span class="token keyword">class</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// called if an exception occurred sending the message</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To connect the observer, you already guessed it, use the <code>ConnectSendObserver</code> method before starting the bus.</p> <h2 id="published-messages"><a href="#published-messages" class="header-anchor">#</a> Published Messages</h2> <p>In addition to send, publish is also observable. Because the semantics matter, absolutely. Using the MessageId to link them up as it's unique for each message. Remember that Publish and Send are two distinct operations so if you want to observe all messages that are leaving your service, you have to connect both Publish and Send observers.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PublishObserver</span> <span class="token punctuation">:</span> <span class="token class-name">IPublishObserver</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> Task <span class="token generic-method"><span class="token function">PrePublish</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>PublishContext<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> context<span class="token punctuation">)</span>
        <span class="token keyword">where</span> T <span class="token punctuation">:</span> <span class="token keyword">class</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// called right before the message is published (sent to exchange or topic)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> Task <span class="token generic-method"><span class="token function">PostPublish</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>PublishContext<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> context<span class="token punctuation">)</span>
        <span class="token keyword">where</span> T <span class="token punctuation">:</span> <span class="token keyword">class</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// called after the message is published (and acked by the broker if RabbitMQ)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> Task <span class="token generic-method"><span class="token function">PublishFault</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>PublishContext<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> context<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span>
        <span class="token keyword">where</span> T <span class="token punctuation">:</span> <span class="token keyword">class</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// called if there was an exception publishing the message</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Finally, to connect the observer, use the <code>ConnectPublishObserver</code> method before starting the bus.</p> <p>These are a ton of interfaces, and they offer a lot of information about how the system is behaving under the hood. So use them, abuse them, bend them, and break them. Just realize, they are immediate, so don't be slow or your messaging will be equally slow.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/MassTransit/MassTransit/edit/develop/docs/advanced/observers.md" target="_blank" rel="noopener noreferrer">Help us by improving this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/15/2019, 1:11:51 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/MassTransit/advanced/connect-endpoint.html" class="prev">Connect Endpoint</a></span> <span class="next"><a href="/MassTransit/advanced/topology/message.html">Message Topology</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/MassTransit/assets/js/app.763fcc25.js" defer></script><script src="/MassTransit/assets/js/6.b9c46cbe.js" defer></script><script src="/MassTransit/assets/js/1.f2cfa088.js" defer></script><script src="/MassTransit/assets/js/34.cc04befa.js" defer></script>
  </body>
</html>
